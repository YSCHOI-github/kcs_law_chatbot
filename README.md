# 법령 통합 챗봇 (KCS Law Chatbot)

**대한민국 관세·무역 법령 전문 AI 챗봇**

## 1인1봇 프로젝트

**AI 시대, 누구나 자신만의 AI 법령 비서를 만들 수 있습니다**

- 복잡한 법령을 즉시 검색하고 답변 받는 나만의 AI 비서
- 코딩 지식 없이도 사용 가능한 웹 인터페이스
- 관세·무역 업무에 특화된 전문 AI 챗봇

---

## 이 챗봇의 3가지 특징

### 1. 무료: 구글 제미나이 무료 모델 사용

- **비용**: 완전 무료 (Google Gemini 2.5 Flash 무료 API 사용)
- **설치**: 개인 노트북이나 Streamlit 무료 클라우드에서 실행 가능

### 2. 멀티 에이전트: 여러 AI의 협업으로 성능 극대화

- **원리**: 각 법령마다 전담 AI가 따로 답변 → Head AI가 최종 정리
- **장점**: 한 번에 여러 법령을 동시 검색, 답변 정확도 향상
- **예시**: "원산지조사는 어떻게 하나요?" 질문 시
  - 관세조사 AI: 관세법 답변
  - FTA AI: 원산지 특례법 답변
  - 통합 AI: 두 답변을 종합하여 명확한 최종 답변 제공

### 3. 하이브리드 RAG (AI + TF-IDF): 일반 노트북에서도 빠르게 구동

- **원리**: AI가 질문을 분석 → TF-IDF가 관련 법조문 검색 → AI가 답변 작성
- **장점**: 고성능 서버 불필요, 일반 노트북에서도 3초 내 답변
- **기술 설명**:
  - **TF-IDF**: 단어 빈도를 계산하여 관련 단어의 중요도와 문장간 유사도를 평가하고 이를 바탕으로 사용자의 질문과 유사한 법조문을 찾는 검색 기술 (빠르고 가벼움)
  - **RAG**: 검색한 법조문을 AI에게 제공하여 정확한 답변 생성

---

## 데이터

### 5개 법령 패키지 (총 43개 법령 파일)

- **관세조사** (9개 법령): 관세법, 관세법 시행령·규칙, 관세조사 운영훈령 등
- **외환조사** (3개 법령): 외국환거래법, 시행령, 외국환거래규정
- **대외무역** (4개 법령): 대외무역법, 시행령, 대외무역관리규정 등
- **FTA** (18개 법령): FTA 특례법, 원산지조사 운영훈령, 10개국 협정문 등
- **환급** (9개 법령): 환급특례법, 시행령·규칙, 관련 고시·예규

### 데이터 구조

- **형식**: 법령 API에서 다운로드 후 JSON 파일로 저장
- **구조**: 각 법조문을 "조 번호", "제목", "내용"으로 분리
- **예시**:
  ```json
  {
    "조번호": "1",
    "제목": "목적",
    "내용": "제1조(목적) 이 법은 관세의 부과·징수..."
  }
  ```

### 3단 비교 기능

- **원리**: 법률 → 시행령 → 시행규칙을 한눈에 비교
- **예시**: 관세법 제38조 클릭 시, 관세법 시행령 제38조, 시행규칙 제38조까지 자동 표시

---

## 사용법

### 질의 응답 기능 (AI 챗봇 탭)

**"법령을 외우지 않아도 질문하면 AI가 찾아서 답변합니다"**

#### 사용 순서

1. 패키지 선택 (예: "관세조사" 버튼 클릭)
2. 채팅창에 질문 입력 (예: "납세고지서는 언제 발급하나요?")
3. 3초 내 AI 답변 확인
4. 필요시 "각 법령별 답변 보기" 확장하여 상세 근거 확인

#### 주요 기능

- **대화 기록 유지**: 이전 대화 맥락을 기억하여 연속 질문 가능
- **스트리밍 답변**: 답변이 실시간으로 타이핑되듯 표시
- **근거 조문 표시**: 답변 하단에 참고한 법조문 전체 표시

#### 활용 예시

- **질문**: "관세조사 기간은 얼마인가요?"
- **답변**: "관세법 제110조에 따르면 원칙적으로 20일 이내이며..."

### 법령 검색 기능 (법령 검색 탭)

**"법령 원문을 Ctrl+F처럼 빠르게 검색합니다"**

#### 사용 순서

1. 검색할 법령 선택 (체크박스로 여러 개 선택 가능)
2. 검색어 입력 (예: "경정청구")
3. 검색어가 노란색으로 강조 표시된 법조문 확인

#### 검색 모드

- **조문 제목+내용 균형 모드** (기본값): 조문 제목도 함께 검색 (제목이 상세한 법령에 적합)
- **내용 전용 모드**: 법조문 내용만 검색 (일반적인 경우 추천)

#### 활용 예시

- "환급" 검색 → 환급 관련 모든 조문이 한 번에 표시
- 제38조 검색 → 제38조 전문 즉시 확인

### 사용자 법령 업로드 기능

**"내가 보유한 법령 파일도 AI가 분석합니다"**

- **지원 형식**: JSON 파일 (법령 API 다운로드 형식)
- **사용법**: 사이드바에서 파일 업로드 → 즉시 검색·질의 가능
- **활용**: 내부 규정, 미등록 법령 등 추가 분석

---

## 한계

### 알아두어야 할 제약사항

#### AI 답변의 한계

- AI는 법령을 참고하여 답변하지만, **법적 효력은 없습니다**
- 중요한 결정은 반드시 법령 원문과 전문가 검토 필요
- **예시**: 계약서 작성, 법적 분쟁 시 반드시 변호사 상담 필요

#### 데이터 최신성

- **법령 업데이트**: 수동으로 다운로드 필요 (`download_packages.py` 실행)
- **권고 주기**: 분기별 1회 업데이트 권장
- **개정 법령 즉시 반영 불가**: API 다운로드 후 재실행 필요

#### 검색 정확도

- **오타나 띄어쓰기에 민감**: "납세고지서" ≠ "납세 고지서"
- **법령 용어 사용 필요**: 일상 언어보다 법령 용어 사용 시 검색 정확도 향상
- **예시**: "세금 내라는 종이" (X) → "납세고지서" (O)

#### 기술적 한계

- **동시 사용자**: 1명 권장 (개인 노트북 실행 시)
- **응답 속도**: 첫 실행 시 느림 (법령 로딩에 5-10초 소요)
- **메모리 사용**: 큰 패키지 로드 시 8GB RAM 권장

---

## 프로젝트 구조

```
kcs_law_chatbot/
├── main.py                         # 메인 프로그램 (실행 파일)
├── utils/                          # 핵심 기능 모듈
│   ├── ai/                         # AI 관련 기능
│   │   ├── agents.py              # 멀티 에이전트 시스템
│   │   ├── query_expander.py     # 질문 분석 및 키워드 확장
│   │   └── models.py              # AI 모델 설정
│   ├── tfidf/                     # 검색 엔진
│   │   ├── search.py             # TF-IDF 검색 로직
│   │   ├── vectorizer.py         # 법령 텍스트 벡터화
│   │   └── cache.py              # 검색 속도 향상용 캐시
│   ├── preprocessing.py           # 법령 텍스트 전처리
│   └── file_upload.py            # 사용자 파일 업로드 처리
├── law_article_search.py          # 법령 검색 UI
├── download_packages.py           # 법령 다운로드 스크립트
├── laws/                          # 법령 데이터 (JSON 파일)
│   ├── customs_investigation.json
│   ├── foreign_exchange_investigation.json
│   ├── foreign_trade.json
│   ├── free_trade_agreement.json
│   └── refund.json
├── cache/                         # 검색 성능 향상용 캐시 폴더
├── requirements.txt               # 필요한 프로그램 목록
└── README.md                      # 사용 설명서
```

### 핵심 파일 설명

- **`main.py`**: 프로그램 시작 파일 (여기서 실행)
- **`utils/`**: AI와 검색 기능이 들어있는 폴더
- **`laws/`**: 법령 데이터 저장 폴더 (JSON 형식)
- **`cache/`**: 검색 속도를 빠르게 하는 임시 파일 저장소

---

## 기술 아키텍처

### 전체 동작 원리

```
[사용자 질문]
    ↓
[AI가 질문 분석] → 핵심 키워드 추출
    ↓
[TF-IDF 검색] → 관련 법조문 찾기
    ↓
[멀티 에이전트] → 각 법령별 AI가 답변
    ↓
[통합 AI] → 최종 답변 정리
    ↓
[사용자에게 답변 표시]
```

### 핵심 기술 3가지

#### 1. 멀티 에이전트 시스템

- **쉬운 설명**: 여러 명의 법령 전문가가 동시에 답변 → 종합 정리
- **기술 원리**: 5개 AI가 병렬로 동시 실행 (ThreadPoolExecutor)
- **장점**: 검색 시간 단축 (5초 → 1초), 다양한 관점 답변

#### 2. 하이브리드 RAG

- **쉬운 설명**: AI + 검색엔진 조합
- **단계**:
  1. AI가 질문에서 핵심 단어 추출 (예: "관세조사" → "조사", "납세의무자", "과세자료")
  2. TF-IDF가 단어 빈도로 관련 법조문 검색
  3. AI가 검색 결과를 보고 답변 작성
- **장점**: 고성능 서버 불필요, 정확도 높음

#### 3. TF-IDF 검색

- **쉬운 설명**: 단어 빈도로 유사 문서 찾기
- **예시**:
  - "관세조사" 질문 → "조사"가 10번 나온 조문 우선 표시
  - "환급" 질문 → "환급"이 많이 나온 조문 우선 표시
- **장점**: 빠름 (0.1초 내), 전력 소모 적음, 노트북에서도 가능

### 검색 모드 설정

#### 조문 제목+내용 균형 모드 (기본값)

- **가중치**: 제목 50% + 내용 50%
- **적합한 경우**: 조문 제목이 상세한 법령 (예: FTA 협정문)

#### 내용 전용 모드

- **가중치**: 제목 0% + 내용 100%
- **적합한 경우**: 일반 법령 (제목이 "목적", "정의" 등 단순한 경우)

---

## 설치 및 실행 방법

### 필수 프로그램

- **Python 3.9 이상**
- **인터넷 연결** (Google API 사용)

### 필수 API 키 발급

1. **Google API Key** (필수): [Google AI Studio](https://aistudio.google.com/apikey)에서 무료 발급
2. **법령 API Key** (선택): [법제처 오픈API](https://www.law.go.kr/LSW/openApi/openApiInfo.do)에서 무료 발급
3. **행정규칙 API Key** (선택): 법령 업데이트 시에만 필요

### 설치 및 실행 (Windows 기준)

#### 1단계: 프로그램 다운로드

```bash
git clone https://github.com/YSCHOI-github/kcs_law_chatbot.git
cd kcs_law_chatbot
```

#### 2단계: 필요한 라이브러리 설치

```bash
pip install -r requirements.txt
```

#### 3단계: API 키 설정

`.env` 파일 생성 후 아래 내용 입력:

```
GOOGLE_API_KEY=여기에_발급받은_구글_API_키_입력
LAW_API_KEY=여기에_법령_API_키_입력 (선택)
ADMIN_API_KEY=여기에_행정규칙_API_키_입력 (선택)
```

#### 4단계: 프로그램 실행

```bash
streamlit run main.py
```

#### 5단계: 웹 브라우저에서 사용

- 자동으로 브라우저 열림
- 또는 주소창에 `http://localhost:8501` 입력

### 법령 업데이트 방법

```bash
python download_packages.py
```

- 최신 법령을 `laws/` 폴더에 다운로드
- 분기별 1회 실행 권장

---

## 주요 의존성

```python
streamlit              # 웹 애플리케이션 프레임워크
google-generativeai    # Gemini AI 모델 연동
scikit-learn          # TF-IDF 벡터화
requests              # 법령 API 호출
python-dotenv         # 환경변수 관리
```

---

## 라이선스

**MIT License**

- 누구나 자유롭게 사용, 수정, 배포 가능
- 상업적 이용 가능
- 단, 원저작자 표시 필수

---

## 개발자 정보

- **개발자**: Yeonsoo CHOI
- **GitHub**: [YSCHOI-github/kcs_law_chatbot](https://github.com/YSCHOI-github/kcs_law_chatbot)
- **문의**: GitHub Issues 탭 활용
- **업데이트**: 2025년 최신 법령 반영
