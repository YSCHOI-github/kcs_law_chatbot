# ⚖️ 법령 통합 챗봇 (KCS Law Chatbot)

**대한민국 관세·무역 법령 전문 AI 챗봇**

## 🚀 1인1봇 프로젝트

**AI 시대, 누구나 자신만의 AI 법령 비서를 무료로 만들 수 있습니다**

- 복잡한 법령을 즉시 검색하고 답변 받는 나만의 AI 비서
- 코딩 지식 없이도 사용 가능한 웹 인터페이스
- 관세·무역 업무에 특화된 전문 AI 챗봇 -> 사용자가 원하는 법령도 업로드 가능

---

## 🌟 이 챗봇의 3가지 특징

### 1. 무료: 구글 제미나이 무료 모델 사용

- **비용**: 완전 무료 (Google Gemini 2.5 Flash 무료 API 사용)
- **설치**: 개인 노트북이나 Streamlit Community Cloud 에서 무료 계정으로 실행 가능

### 2. 멀티 에이전트: 여러 AI의 협업으로 성능 극대화

- **원리**: 각 법령마다 전담 AI가 사용자 질문에 답변 → Head AI가 종합하여 최종 답변
- **AI 답변 출력 과정**:
  - 사용자 질문에 대해 각 법령 AI의 답변을 Expander(열림)에 출력
  - 최종 답변 완성 시 각 법령의 답변이 있는 Expander가 닫히고, HEAD AI의 최종 답변 출력
  - 사용자는 Expander를 열어서 각 법령 AI의 답변 확인 가능   
- **장점**: 한 번에 여러 법령을 동시 검색, 답변 정확도 향상
- **예시**: "관세조사 절차에 대해 상세히 알려줘?" 질문 시
  - 각 AI가 관세법, 시행령, 시행규칙, 관세조사 운영에 관한 훈령, 관세평가 운영에 관한 고시, 관세법 3단비교 법령을 기반으로 답변
  - Head AI가 모든 답변을 종합하여 최종 답변 제공

### 3. 하이브리드 RAG (AI + TF-IDF): 일반 노트북에서도 빠르게 구동

- **원리**: AI가 사용자 질문을 분석 → **유사 질문** 추가 생성 → 법령의 **조문 제목**들을 기반으로 **핵심어**, **유사어**, **관련어** 등 추출 → TF-IDF가 해당 단어들과 유사한 법조문 검색 → AI가 답변 작성
- **장점**: 고성능 서버 불필요, 일반 노트북 및 **Streamlit Community Cloud 무료 계정**에서도 빠르게 답변
- **기술 설명**:
  - **TF-IDF**: 단어 빈도를 계산하여 단어 중요도와 문장간 유사도를 평가하고, 이를 바탕으로 사용자의 질문과 유사한 법조문을 찾는 검색 기술 (빠르고 가벼움)
  - **RAG**: 검색한 법조문을 AI에게 제공하여 정확한 답변 생성

---

## 📚 데이터 - 5개 법령 패키지 + 사용자 추가 업로드 가능

### 📦 5개 법령 패키지 (총 43개 법령 파일)

- **관세조사** : 관세법, 시행령·시행규칙, 관세조사 운영훈령 등
- **외환조사** : 외국환거래법, 시행령, 외국환거래규정 등
- **대외무역** : 대외무역법, 시행령, 대외무역관리규정 등
- **FTA** : FTA 특례법, 시행령·시행규칙, 원산지조사 운영훈령 등
- **환급** : 환급특례법, 시행령·규칙, 관련 고시·예규 등

### 📂 사용자 법령 업로드 기능

**"내가 보유한 법령 파일도 AI가 분석합니다"**

- **지원 형식**: PDF 또는 txt 파일 업로드 하면 JSON 파일로 변환
- **사용법**: 사이드바에서 파일 업로드 → 즉시 검색·질의 가능
- **활용**: 내부 규정, 미등록 법령 등 추가 분석

### 🧩 데이터 구조

- **형식**: 법제처에서 법령 API에서 다운로드 또는 사용자가 PDF, txt 파일 업로드 → JSON 파일로 저장
- **구조**: 각 법조문을 "조 번호", "제목", "내용"으로 분리
- **예시**:
  ```json
  {
    "조번호": "1",
    "제목": "목적",
    "내용": "제1조(목적) 이 법은 관세의 부과·징수..."
  }
  ```

---

## 💬 사용법

### 🤖 질의 응답 기능 (AI 챗봇 탭)

**"법령을 외우지 않아도 질문하면 AI가 찾아서 답변합니다"**

#### 📘 사용 순서

1. 패키지 선택 (예: "관세조사" 버튼 클릭) 또는 사용자가 법령(PDF, txt) 업로드
2. 채팅창에 질문 입력 (예: "가산세 종류 및 각각의 세율은?")
3. 멀티 AI 에이전트들이 답변 확인
4. 필요시 "각 법령별 답변 보기" 확장하여 상세 근거 확인

#### [참고] TF-IDF가 사용자 질문과 유사한 법령을 검색하는 옵션 선택 가능

- **조문 제목+내용 균형 모드** (기본값): 조문 제목(가중치 50%)과 조문 내용(가중치 50%)을 함께 검색 (제목이 상세한 법령에 적합)
- **내용 전용 모드**: 법조문 내용만 검색 (제목이 '정의', '절차', '벌칙' 등 일반적 용어로만 이루어진 법령에 적합)

#### 🧠 주요 기능

- **대화 기록 유지**: 이전 대화 맥락을 기억하여 연속 질문 가능
- **근거 조문 표시**: 답변 하단에 참고한 법조문 전체 표시

#### 💡 활용 예시

- **질문**: "관세조사 기간은 얼마인가요?"
- **답변**: "관세법 제110조에 따르면 원칙적으로 20일 이내이며..."

### 🔍 법령 검색 기능 (법령 검색 탭)

**"법령 원문을 Ctrl+F처럼 빠르게 검색합니다"**

#### 사용 순서

1. 검색할 법령 선택 (체크박스로 여러 개 선택 가능)
2. 검색어 입력 (예: "경정청구", "관세법 제21조")
3. 검색어가 노란색으로 강조 표시된 법조문 확인

---

## ⚠️ 한계

### ⚙️ 알아두어야 할 제약사항

####❗ AI 답변의 한계

- AI는 완벽하지 않고, 실수를 합니다. 
- AI가 모든 법조문을 읽고 답변하는 것이 아닙니다. 사용자 질문과 유사한 법조문을 찾아내서 읽고 답변하는데, 가끔 유사한 법조문을 잘 찾지 못하는 경우도 있습니다. 
- AI는 법령을 참고하여 답변하지만, **법적 효력은 없습니다**
- 중요한 결정은 반드시 법령 원문 확인과 전문가 검토 필요


#### 📅 데이터 최신성

- **법령 업데이트**: 수동으로 다운로드 필요 (`download_packages.py` 실행)
- **개정 법령 즉시 반영 불가**: API 다운로드 후 재실행 필요

#### 🧠 검색 정확도

- **오타나 띄어쓰기에 민감**: "납세고지서" ≠ "납세 고지서"
- **법령 용어 사용 필요**: 일상 언어보다 법조문에 나오는 법령 용어 사용 시 검색 정확도 향상

#### 🔑 제미나이 API 호출 한계 (무료 사용자)

- **분당 요청 수 (RPM)**: 10회
- **분당 토큰 수 (TPM)**: 250,000 토큰
- **일일 요청 수 (RPD)**: 250회
- **Google 검색 연동**: 500 RPD까지 무료

---

## 🧱 프로젝트 구조

```
kcs_law_chatbot/
├── main.py                         # 메인 프로그램 (실행 파일)
├── utils/                          # 핵심 기능 모듈
│   ├── ai/                         # AI 관련 기능
│   │   ├── agents.py              # 멀티 에이전트 시스템
│   │   ├── query_expander.py     # 질문 분석 및 키워드 확장
│   │   └── models.py              # AI 모델 설정
│   ├── tfidf/                     # 검색 엔진
│   │   ├── search.py             # TF-IDF 검색 로직
│   │   ├── vectorizer.py         # 법령 텍스트 벡터화
│   │   └── cache.py              # 검색 속도 향상용 캐시
│   ├── preprocessing.py           # 법령 텍스트 전처리
│   └── file_upload.py            # 사용자 파일 업로드 처리
├── law_article_search.py          # 법령 검색 UI
├── download_packages.py           # 법령 다운로드 스크립트
├── laws/                          # 법령 데이터 (JSON 파일)
│   ├── customs_investigation.json
│   ├── foreign_exchange_investigation.json
│   ├── foreign_trade.json
│   ├── free_trade_agreement.json
│   └── refund.json
├── cache/                         # 검색 성능 향상용 캐시 폴더
├── requirements.txt               # 필요한 프로그램 목록
└── README.md                      # 사용 설명서
```

### 📘 핵심 파일 설명

- **`main.py`**: 프로그램 시작 파일 (여기서 실행)
- **`utils/`**: AI와 검색 기능이 들어있는 폴더
- **`laws/`**: 법령 데이터 저장 폴더 (JSON 형식)
- **`cache/`**: 검색 속도를 빠르게 하는 임시 파일 저장소

---

## 🧠 기술 아키텍처

### ⚙️ 전체 동작 원리

```
[사용자 질문]
    ↓
[AI가 질문 분석] → 핵심 키워드 추출
    ↓
[TF-IDF 검색] → 관련 법조문 찾기
    ↓
[멀티 에이전트] → 각 법령별 AI가 답변
    ↓
[통합 AI] → 최종 답변 정리
    ↓
[사용자에게 답변 표시]
```

### 🧩 핵심 기술 3가지

#### 1. 멀티 에이전트 시스템

- **쉬운 설명**: 여러 명의 법령 전문가가 동시에 답변 → 종합 정리
- **기술 원리**: 5개 AI가 병렬로 동시 실행 (ThreadPoolExecutor)
- **장점**: 검색 시간 1/5로 단축, 다양한 관점 답변

#### 2. 하이브리드 RAG

- **쉬운 설명**: AI + TF-IDF 조합
- **단계**:
  1. AI가 법령용어사전(조문제목 리스트)을 활용하여 사용자 질문과 유사한 질문 3개 생성
  2. AI가 법령용어사전(조문제목 리스트)을 활용하여 사용자 질문과 유사 질문들에서 핵심 단어 추출
  3. TF-IDF가 핵심 단어 빈도(중요도)를 바탕으로 사용자 질문과 유사도가 높은 법조문 검색 → AI에게 제공
  4. 각 AI가 검색 결과를 보고 답변 작성
  5. Head AI가 최종 각 AI 답변을 종합하여 최종 답변 제출
- **장점**: 고성능 서버 불필요, 정확도 높음

### 검색 모드 설정

#### 1. 조문 제목+내용 균형 모드 (기본값)

- **가중치**: 제목 50% + 내용 50%
- **적합한 경우**: 조문 제목이 상세한 법령 (예: FTA 협정문)

#### 2. 내용 전용 모드

- **가중치**: 제목 0% + 내용 100%
- **적합한 경우**: 일반 법령 (제목이 "목적", "정의" 등 단순한 경우)

---

## ⚙️ 설치 및 실행 방법

### 💻 필수 프로그램

- **Python 3.13.7**
- **인터넷 연결** (Google API 사용)

### 🔑 필수 API 키 발급

1. **Google API Key** (필수): [Google AI Studio](https://aistudio.google.com/apikey)에서 무료 발급
2. **법령 API Key** (선택): [법제처 오픈API](https://www.law.go.kr/LSW/openApi/openApiInfo.do)에서 무료 발급
3. **행정규칙 API Key** (선택): 법령 업데이트 시에만 필요

### 🧾 설치 및 실행 (Windows 기준)

#### 1단계: 프로그램 다운로드

```bash
git clone https://github.com/YSCHOI-github/kcs_law_chatbot.git
cd kcs_law_chatbot
```

#### 2단계: 필요한 라이브러리 설치

```bash
pip install -r requirements.txt
```

#### 3단계: API 키 설정

`.env` 파일 생성 후 아래 내용 입력:

```
GOOGLE_API_KEY=여기에_발급받은_구글_API_키_입력
LAW_API_KEY=여기에_법령_API_키_입력 (선택)
ADMIN_API_KEY=여기에_행정규칙_API_키_입력 (선택)
```

#### 4단계: 프로그램 실행

```bash
streamlit run main.py
```

#### 5단계: 웹 브라우저에서 사용

- 자동으로 브라우저 열림
- 또는 주소창에 `http://localhost:8501` 입력

### 법령 업데이트 방법

```bash
python download_packages.py
```

- 최신 법령을 `laws/` 폴더에 다운로드
- 분기별 1회 실행 권장

---

## 🧮 주요 의존성

```python
streamlit              # 웹 애플리케이션 프레임워크
google-genai           # Gemini AI 모델 연동
scikit-learn          # TF-IDF 벡터화
requests              # 법령 API 호출
python-dotenv         # 환경변수 관리
```

---

## 📜 라이선스

**MIT License**

- 누구나 자유롭게 사용, 수정, 배포 가능
- 상업적 이용 가능
- 단, 원저작자 표시 필수

---

## 개발자 정보

- **개발자**: Yeonsoo CHOI
- **GitHub**: [YSCHOI-github/kcs_law_chatbot](https://github.com/YSCHOI-github/kcs_law_chatbot)

