# 🏛️ 법령 통합 챗봇 (KCS Law Chatbot)

대한민국 관세·무역 법령에 특화된 멀티에이전트 AI 챗봇 시스템

## 🎯 핵심 특징

### 1. **멀티에이전트 시스템**
- **전문가 에이전트**: 각 법령별로 독립적인 AI 에이전트 운영
- **헤드 에이전트**: 모든 에이전트 답변을 통합하여 최종 답변 생성
- **병렬 처리**: 비동기(async) 방식으로 여러 에이전트 동시 실행
- **AI 자동 분류**: 질문 내용을 분석하여 관련 법령 카테고리 자동 선택

### 2. **AI + TF-IDF 하이브리드 RAG**
- **QueryPreprocessor**: AI 기반 키워드 확장 및 유사 질문 생성
- **TF-IDF 벡터화**: 빠르고 정확한 문서 유사도 계산
- **스마트 청킹**: 법령 구조에 최적화된 텍스트 분할
- **임베딩 캐싱**: 처리된 데이터 재사용으로 성능 최적화

### 3. **법조문 원문 검색**
- **구조화된 조문 파싱**: PDF → JSON 변환으로 조/항/목 구조 보존
- **하이라이트 검색**: 검색어 강조 표시 기능
- **멀티 법령 검색**: 여러 법령 동시 검색 지원
- **실시간 검색**: Ctrl+F 스타일의 즉시 검색

## 📁 프로젝트 구조

```
kcs_law_chatbot/
├── main.py                    # Streamlit 메인 애플리케이션
├── utils.py                   # 핵심 기능 및 유틸리티
├── law_article_search.py      # 법령 원문 검색 기능
├── laws/                      # PDF 법령 파일 디렉토리
└── README.md                  # 프로젝트 문서
```

## 🔧 주요 기능

### 멀티에이전트 AI 챗봇
- **6개 전문 분야**: 관세조사, 관세평가, 자유무역협정, 외국환거래, 대외무역거래, 환급
- **대화형 인터페이스**: 채팅 기반 질의응답
- **컨텍스트 유지**: 이전 대화 내용 기반 연속 대화
- **개별 에이전트 답변**: 각 법령 전문가의 상세 답변 제공

### 지능형 검색 시스템
- **AI 질문 분석**: Gemini 모델을 활용한 질문 의도 파악
- **키워드 확장**: 동의어, 유사어 자동 생성
- **가중치 검색**: 원본 쿼리와 확장 키워드 조합 검색
- **임계값 필터링**: 관련도 기반 결과 선별

### 원문 검색 도구
- **조문별 검색**: 제X조 단위 구조화 검색
- **전문 검색**: 법령 전체 텍스트 검색
- **검색어 하이라이트**: 매칭된 부분 시각적 강조
- **다중 선택**: 원하는 법령만 선택적 검색

## 🏗️ 기술 아키텍처

### 데이터 처리 파이프라인
```
PDF 파일 → pdfminer 텍스트 추출 → 조문 구조 파싱 → JSON 변환 → TF-IDF 벡터화 → 검색 인덱스
```

### AI 에이전트 워크플로우
```
사용자 질문 → 카테고리 분류 → 키워드 확장 → 병렬 에이전트 실행 → 헤드 에이전트 통합 → 최종 답변
```

### 검색 엔진 구조
```
쿼리 입력 → 전처리 → TF-IDF 유사도 계산 → 임계값 필터링 → 결과 정렬 → 하이라이트 적용
```

## 💡 핵심 알고리즘

### 멀티에이전트 시스템
- **비동기 병렬 처리**: `asyncio.gather()`로 에이전트 동시 실행
- **ThreadPoolExecutor**: AI 모델 호출 최적화
- **세션 상태 관리**: Streamlit 세션을 통한 데이터 영속성

### 하이브리드 RAG
- **AI 키워드 확장**: Gemini 모델 기반 의미론적 확장
- **TF-IDF 검색**: 통계적 텍스트 유사도 계산
- **가중치 조합**: 원본(1.0) + 확장(0.8) 가중 평균
- **동적 임계값**: 결과 품질 기반 적응적 필터링

### 법조문 파싱
- **정규식 패턴**: `제\d+(?:-\d+)?조(?:의\d+)?\s*\((.*?)\)` 조문 인식
- **구조 보존**: 조번호, 제목, 내용 분리 저장
- **텍스트 정제**: 불용어 제거 및 노이즈 필터링

## 🚀 성능 최적화

### 캐싱 전략
- **@st.cache_data**: 임베딩 및 법령 데이터 캐싱
- **세션 임베딩**: 처리된 벡터 데이터 메모리 보관
- **이벤트 루프 재사용**: asyncio 루프 영속화

### 메모리 관리
- **청크 기반 처리**: 1000자 단위 텍스트 분할
- **오버랩 청킹**: 50% 겹침으로 정보 손실 방지
- **선택적 로딩**: 카테고리별 필요 데이터만 로드

## 📊 지원 법령

### 관세조사 (5개)
- 관세법, 시행령, 시행규칙
- 관세평가 운영에 관한 고시
- 관세조사 운영에 관한 훈령

### 관세평가 (12개)
- WTO관세평가협정, TCCV기술문서 등
- Customs Valuation Archer (5개 파트)

### 자유무역협정 (6개)
- 원산지조사 운영에 관한 훈령
- 자유무역협정 특례법 관련 법령

### 외국환거래 (3개)
- 외국환거래법, 시행령, 규정

### 대외무역거래 (4개)
- 대외무역법, 시행령, 관리규정
- 원산지표시제도 운영에 관한 고시

### 환급 (9개)
- 환급특례법, 시행령, 시행규칙
- 각종 환급 관련 고시 및 예규

## 🛠️ 주요 의존성

```python
streamlit              # 웹 애플리케이션 프레임워크
google-generativeai    # Gemini AI 모델 연동
PyPDF2                # PDF 텍스트 추출
pdfminer              # 고급 PDF 파싱
scikit-learn          # TF-IDF 벡터화
numpy                 # 수치 연산
python-dotenv         # 환경변수 관리
```

## 🎨 사용자 인터페이스

### 탭 구조
- **💬 AI 법률 챗봇**: 멀티에이전트 대화형 인터페이스
- **🔍 법령 원문 검색**: 구조화된 조문 검색 도구

### 인터랙션 요소
- **카테고리 버튼**: 7개 전문 분야 + AI 자동 분류
- **채팅 인터페이스**: 대화 기록 유지 및 스트리밍 응답
- **에이전트 답변 확장**: 개별 전문가 의견 상세 보기
- **검색 필터**: 다중 법령 선택 및 하이라이트 표시

## 🔍 검색 최적화

### 불용어 처리
- **법령 특화 불용어**: 조항, 규정, 법률 등 구조어 제거
- **일반 불용어**: 관사, 조사, 접속사 필터링
- **동적 가중치**: 검색 정확도 기반 점수 조정

### 결과 개선
- **의미론적 확장**: AI 기반 쿼리 리라이팅
- **구문 분석**: 복합 검색어 자동 분리
- **랭킹 알고리즘**: 코사인 유사도 + 가중치 조합

---

**개발자**: Yeonsoo CHOI  
**라이선스**: MIT License  
**업데이트**: 2024년 최신 법령 반영
